<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile</title>
    <link href="/util.css" rel="stylesheet"/>
</head>
<body>
{{>util/header}}
<main style="width: 100%; display: flex; flex-direction: column; align-items: center; align-items: center; display: flex; flex-direction: column; height: 100vh; justify-content: center;"> <section>
        {{#account}}
            <form id="update-account-form" style="width: 100%;">
                <div class="text-field">
                    <label>full name</label>
                    <input name="fullName" type="text" value="{{fullName}}" required autofocus>
                </div>
                <div class="text-field">
                    <label>title</label>
                    <input name="title" type="text" value="{{title}}" required>
                    <span id="email-taken" class="error-msg" style="float:right; text-decoration: underline;">email already in use</span>
                </div>
                <div class="text-field">
                    <label>email</label>
                    <input name="email" type="email" value="{{email}}" required>
                </div>
                <div class="text-field">
                    <label>password</label>
                    <input name="password" type="password" required>
                    <span id="password-mismatch" class="error-msg" style="float:right; text-decoration: underline;">password doesn't match</span>
                </div>
                <div class="text-field">
                    <label>repeat password</label>
                    <input name="passwordConfirmation" type="password" required>
                </div>
                <div class="text-field">
                    <label>affiliation</label>
                    <input name="affiliation" type="text" value="{{affiliation}}" required>
                </div>
                <div class="text-field">
                    <label>job type</label>
                    <input name="jobType" type="text" value="{{jobType}}" required>
                </div>
                <div class="text-field">
                    <label>country</label>
                    <input name="country" type="text" value="{{country}}" required>
                </div>
                <div class="text-field">
                    <label>city</label>
                    <input name="city" type="text" value="{{city}}" required>
                </div>
                <div class="text-field">
                    <label>address</label>
                    <input name="address" type="text" value="{{address}}" required>
                </div>
                <div class="text-field">
                    <label>zipcode</label>
                    <input name="zipCode" type="text" value="{{zipCode}}" required>
                </div>
                <div style="display: flex; justify-content: center;">
                    <button class="m3-button yellow-button">Update</button>
                </div>
            </form>
            <script>
                const form = document.getElementById('update-account-form');
                const formData = new FormData(form);
                form.addEventListener('submit', async () => {
                    const response = fetch('/api/account', { method: 'PUT', body: formData });
                    if(!response.ok) {
                        const error = await response.text();
                        if(error.includes('password-mismatch')) {
                            document.getElementById('password-mismatch').style.display = 'inline-block';
                            document.getElementById('password').focus()
                        }
                        if(error.includes('email-taken')) {
                            document.getElementById('email-taken').style.display = 'inline-block';
                            document.getElementById('email').focus()
                        }
                        return;
                    }
                    window.location.href = '/profile/{{id}}';
    });
            </script>
        {{/account}}
    </section>
</main>
</body>
<style>
    .text-field input {
        background-color: white;
    }
</style>
</html>