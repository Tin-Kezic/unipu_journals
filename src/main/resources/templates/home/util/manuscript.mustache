<script>
class Manuscript extends HTMLElement {
  static observedAttributes = ['id', 'title', 'description', 'authors', 'download-url', 'submission-date', 'publication-date'];
  constructor() { super(); }
  connectedCallback() { this.render(); }
  attributeChangedCallback(name, oldValue, newValue) {
    if(newValue != oldValue) this.render();
  }
  render() {
    this._id = this.getAttribute('id').replace(/^.*-/, '');
    this._title = this.getAttribute('title');
    this._description = this.getAttribute('description');
    this._authors = JSON.parse(this.getAttribute('authors')?.replace(', ]', ']') || '[]');
    this._submissionDate = this.getAttribute('submission-date');
    this._publicationDate = this.getAttribute('publication-date');
    this._date = this.getAttribute('date');
    this._downloadUrl = this.getAttribute('download-url');
    this.innerHTML = `
      <article data-id="${this._id}" onclick="window.location='${this._downloadUrl}'" class="container" style="width: auto; height: auto; max-width: 100%;">
        <p class="container-text">${this._title}</p>
        <div class="authors" style="display: flex; flex-wrap: wrap; font-weight: 100; font-size: 0.8rem;">
          ${this._authors?.map(author => `<button>${author}</button>`).join('')}
        </div>
        <p style="font-weight: 100; font-size: 0.8rem; margin-bottom: 0.5rem; margin-top: 0.2rem;">
          ${this._publicationDate ? `Published: ${this._publicationDate}` : `Submitted: ${this._submissionDate}`}
        </p>
        <p style="font-weight: 100; font-size: 0.8rem">${this._description}</p>
        <!--
        {{#isSectionEditorOrSuperior}}
          <footer class="container-buttons" style="margin-top: 0.5rem; margin-bottom: 0;">
            {{#isAdmin}}
              <button onclick="event.stopPropagation()" class="m3-button outline-button" data-type="hide-button" data-id="{{id}}" data-title="{{title}}" style="width: auto; border-radius: 10rem; box-shadow: none; padding-inline: 1.7rem;">Hide</button>
            {{/isAdmin}}
            <button onclick="event.stopPropagation()" class="m3-button purple-button" data-type="archive-button" data-id="{{id}}" data-title="{{title}}" style="box-shadow: none; width: auto; border-radius: 10rem; padding-block: 0.523rem; text-wrap: nowrap;">Move to archive</button>
          </footer>
        {{/isSectionEditorOrSuperior}}
        -->
      </article>
    `;
  }
}
customElements.define('manuscript-element', Manuscript);
</script>