<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link href="/util.css" rel="stylesheet"/>
</head>

<body style="align-items: center;
        display: flex;
        flex-direction: column;
        height: 100vh;">

<h1 style="font-size: 3.5rem;">Unipu Journals</h1>
<p style="font-size: 1.3rem; color: var(--light-grey);">University of Pula academic journals</p>

<main style="max-width: 22.5rem; width: 100%; display: flex; flex-direction: column; align-items: center;">
    <section>
        <form id="register-form" style="width: 100%;">
            <div class="text-field">
                <label>full name </label>
                <input name="fullName" type="text" required autofocus>
            </div>
            <div class="text-field">
                <label>title</label>
                <input name="title" type="text" required>
                <span id="email-taken" class="error-msg" style="float:right; text-decoration: underline;">email already in use</span>
            </div>
            <div class="text-field">
                <label>email</label>
                <input name="email" type="email" required>
            </div>
            <div class="text-field">
                <label>password</label>
                <input name="password" type="password" required>
                <span id="password-mismatch" class="error-msg" style="float:right; text-decoration: underline;">password doesn't match</span>
            </div>
            <div class="text-field">
                <label>repeat password</label>
                <input name="passwordConfirmation" type="password" required>
            </div>
            <div class="text-field">
                <label>affiliation</label>
                <input name="affiliation" type="text" required>
            </div>
            <div class="text-field">
                <label>job type</label>
                <input name="jobType" type="text" required>
            </div>
            <div class="text-field">
                <label>country</label>
                <input name="country" type="text" required>
            </div>
            <div class="text-field">
                <label>city</label>
                <input name="city" type="text" required>
            </div>
            <div class="text-field">
                <label>address</label>
                <input name="address" type="text" required>
            </div>
            <div class="text-field">
                <label>zipcode</label>
                <input name="zipCode" type="text" required>
            </div>
            <div style="display: flex; justify-content: center;">
                <button class="m3-button yellow-button">Register</button>
            </div>
        </form>
    </section>
</main>
</body>
<script>
    const form = document.getElementById('register-form');
    form.addEventListener('submit', async (event) => {
        event.preventDefault();
        if(form.password.value !== form.passwordConfirmation.value) {
            document.getElementById('password-mismatch').style.display = 'inline-block';
            document.getElementById('password').focus()
            return;
        }
        const response = await fetch(`/api/accounts`, {
            method: 'POST',
            body: new URLSearchParams({
                fullName: form.fullName.value,
                title: form.title.value,
                email: form.email.value,
                password: form.password.value,
                affiliation: form.affiliation.value,
                jobType: form.jobType.value,
                country: form.country.value,
                city: form.city.value,
                address: form.address.value,
                zipCode: form.zipCode.value
            })
        });
        if(!response.ok) {
            const error = await response.text();
            document.getElementById('email-taken').style.display = error.includes('email taken') ? 'inline-block': 'none';
            if(error.includes('email taken')) { document.getElementById('email').focus() }
            return;
        }
        window.location = '/authentication/verify-your-email.html';
    });
</script>
<style>
    .text-field input {
        background-color: white;
    }
</style>
</html>